import{U as $,Q as b,W as L,a3 as K,r,X as N,H as k,L as C,h as t,Y as B,Z as M,_ as V,l as m,u as tt,aF as st,aG as H,n as A,a6 as et,a5 as at,a7 as ot,I as h,aH as nt,C as it,S as _,A as rt,a9 as dt,aI as lt,aJ as ct,aK as ut,R as pt}from"./main.js";import{s as gt,u as ft,i as mt}from"./Actions-8aac1865.js";import{h as Ct,j as xt,B as j}from"./settings-cc0e1832.js";import"./popper-0aa08b12.js";function ht(s){return $("MuiCard",s)}b("MuiCard",["root"]);const jt=["className","raised"],Rt=s=>{const{classes:a}=s;return M({root:["root"]},ht,a)},wt=L(K,{name:"MuiCard",slot:"Root",overridesResolver:(s,a)=>a.root})(()=>({overflow:"hidden"})),yt=r.forwardRef(function(a,i){const o=N({props:a,name:"MuiCard"}),{className:d,raised:c=!1}=o,p=k(o,jt),g=C({},o,{raised:c}),f=Rt(g);return t.jsx(wt,C({className:B(f.root,d),elevation:c?8:void 0,ref:i,ownerState:g},p))}),St=yt;function vt(s){return $("MuiCardActions",s)}b("MuiCardActions",["root","spacing"]);const At=["disableSpacing","className"],_t=s=>{const{classes:a,disableSpacing:i}=s;return M({root:["root",!i&&"spacing"]},vt,a)},$t=L("div",{name:"MuiCardActions",slot:"Root",overridesResolver:(s,a)=>{const{ownerState:i}=s;return[a.root,!i.disableSpacing&&a.spacing]}})(({ownerState:s})=>C({display:"flex",alignItems:"center",padding:8},!s.disableSpacing&&{"& > :not(:first-of-type)":{marginLeft:8}})),bt=r.forwardRef(function(a,i){const o=N({props:a,name:"MuiCardActions"}),{disableSpacing:d=!1,className:c}=o,p=k(o,At),g=C({},o,{disableSpacing:d}),f=_t(g);return t.jsx($t,C({className:B(f.root,c),ownerState:g,ref:i},p))}),Lt=bt;function Nt(s){return $("MuiCardContent",s)}b("MuiCardContent",["root"]);const kt=["className","component"],Bt=s=>{const{classes:a}=s;return M({root:["root"]},Nt,a)},Mt=L("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(s,a)=>a.root})(()=>({padding:16,"&:last-child":{paddingBottom:24}})),Ut=r.forwardRef(function(a,i){const o=N({props:a,name:"MuiCardContent"}),{className:d,component:c="div"}=o,p=k(o,kt),g=C({},o,{component:c}),f=Bt(g);return t.jsx(Mt,C({as:c,className:B(f.root,d),ownerState:g,ref:i},p))}),Et=Ut;const Pt=r.lazy(()=>V(()=>import("./Row-e6cadacf.js"),["./Row-e6cadacf.js","./main.js","./main-1e2463ed.css","./Row-44b4d6d7.css"],import.meta.url)),Ft=r.lazy(()=>V(()=>import("./DebugInfo-f5539317.js"),["./DebugInfo-f5539317.js","./main.js","./main-1e2463ed.css"],import.meta.url)),Ot=({formId:s,dbs:a,tbl:i,metaData:o,primaryKey:d,formMode:c,showTable:p,showForm:g})=>{m.debug(a,i,o,d,c);const f=tt(),U=r.useMemo(()=>st(),[]),[W,E]=r.useState(!1),[P,F]=r.useState(null),[R,w]=r.useState(null),[G,T]=r.useState(!1),[y,D]=r.useState(!1);r.useEffect(()=>{d===null?J():Y()},[d]);const I=()=>{const e=[];for(let u=0;u<o.columns.length;u++)e[u]={visible:!0,updatable:!0,cells:1};m.debug(e),f(lt({formId:s,columns:e}))},Y=()=>{gt(a,i,d,function(e){m.debug(e),f(H({formId:s,data:e})),I(),F(e),E(e!==null)})},J=()=>{if(o.columns&&Array.isArray(o.columns)){const e={};for(let u=0;u<o.columns.length;u++)e[o.columns[u].column_name]=null;m.debug(e),f(H({formId:s,data:e})),m.debug("init"),I(),F(e),E(!0)}},S=e=>{const u=ct(ut.getState(),s);d!==null?ft(a,i,d,u,function(n){n&&n.data&&n.data.data&&n.data.code&&n.data.code.toLowerCase()==="ok"?n.data.data==="Row successfully updated"?(T(!0),w({severity:"success",message:n.data.data}),e&&p(!0)):n.data.data==="Nothing to update"&&(w({severity:"info",message:n.data.data}),e&&p(G)):m.error(n)}):mt(a,i,u,function(n){if(n&&n.data&&n.data.data&&n.data.code&&n.data.code.toLowerCase()==="ok"){if(n.data.data==="Row successfully inserted"){T(!0),w({severity:"success",message:n.data.data}),e&&p(!0);const z={};for(let x=0;x<o.primary_key.length;x++)z[o.primary_key[x].name]=u.columns[o.primary_key[x].name];g(z,pt.UPDATE)}}else m.error(n)})},Q=()=>{S(!1)},X=()=>{S(!0)},v=()=>{p(G)},Z=A(e=>et(e,s));let O="";Z&&(O+=" yd-form-grid");const q=A(e=>at(e,s)),l=A(e=>ot(e,s));return t.jsx(t.Fragment,{children:t.jsx("div",{className:`${s}_wrapper yd-form`,children:W&&P!==null?t.jsxs(t.Fragment,{children:[t.jsx(Ct,{position:"static",sx:{marginBottom:`${l.betweenContainers}px`,borderRadius:"4px"},children:t.jsxs(xt,{sx:{backgroundColor:"#fff",justifyContent:"space-between",borderRadius:"4px",paddingLeft:`${l.aroundGridLeft}px`,paddingRight:`${l.aroundGridRight}px`,"@media (min-width: 600px)":{paddingLeft:`${l.aroundGridLeft}px`,paddingRight:`${l.aroundGridRight}px`}},children:[t.jsx(h,{onClick:v,children:t.jsx("i",{className:"fa-solid fa-angles-left"})}),t.jsxs("span",{children:[!y&&t.jsx(h,{onClick:()=>{D(!0)},children:t.jsx("i",{className:"fa-solid fa-bug"})}),y&&t.jsx(h,{onClick:()=>{D(!1)},children:t.jsx("i",{className:"fa-solid fa-bug-slash"})}),t.jsx(h,{className:"setting",onClick:()=>{f(nt({formId:s}))},children:t.jsx("i",{className:"fa-solid fa-gear"})})]})]})}),y&&it.appDebug&&t.jsx("div",{style:{marginBottom:`${l.betweenContainers}px`},children:t.jsx(r.Suspense,{fallback:t.jsx(_,{}),children:t.jsx(Ft,{formId:s})})}),R!==null&&t.jsx(rt,{severity:R.severity,message:R.message,now:Date.now().toString()}),t.jsxs(St,{sx:{paddingTop:`${l.aroundGridTop}px`,paddingBottom:`${l.aroundGridTop}px`,paddingLeft:`${l.aroundGridLeft}px`,paddingRight:`${l.aroundGridRight}px`},children:[t.jsx(Et,{sx:{padding:0},children:t.jsx("form",{id:U,className:`yd-form-content ${O}`,style:{gridTemplateColumns:`repeat(${q}, 1fr)`,gap:`${l.betweenCells}px`,marginBottom:0},onSubmit:e=>(S(!1),e.preventDefault(),!1),children:t.jsx(r.Suspense,{fallback:t.jsx(_,{}),children:t.jsx(Pt,{formId:s,dbs:a,tbl:i,metaData:o,data:P,primaryKey:d,formMode:c})})})}),t.jsx(Lt,{sx:{marginTop:`${l.betweenCells}px`,padding:0,paddingRight:`${l.cellRight}px`,justifyContent:"flex-end"},children:c===dt.EDIT?t.jsxs(t.Fragment,{children:[t.jsx(j,{variant:"contained",onClick:Q,type:"submit",form:U,children:"APPLY"}),t.jsx(j,{variant:"contained",onClick:X,sx:{marginLeft:"16px"},children:"OK"}),t.jsx(j,{variant:"contained",onClick:v,sx:{marginLeft:"16px"},children:"CANCEL"})]}):t.jsx(j,{variant:"contained",onClick:v,children:"BACK"})})]})]}):t.jsx("div",{style:{padding:"50px"},children:t.jsx(_,{title:"Loading data..."})})})})};export{Ot as default};
